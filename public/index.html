<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SisLaudos - Processador de Laudos Médicos</title>
  
  <link rel="icon" href="doctor.png" type="image/png">

  <style>
/* Estilos do corpo e container */
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  padding: 20px;
  background-color: #f9f9f9;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  background-color: #fff;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

h1, h2 {
  text-align: center;
  color: #333;
}

/* Estilos para textarea e inputs */
textarea, input[type="text"], input[type="file"] {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  box-sizing: border-box;
  border-radius: 5px;
  border: 1px solid #ddd;
}

textarea {
  border: 1px solid #007bff;
  transition: border 0.3s;
}

textarea:focus {
  border-color: #0056b3;
}

.button-group {
  text-align: center;
}

button {
  padding: 10px 20px;
  margin: 10px;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s;
}

button:hover {
  background-color: #0056b3;
}

/* Estilos para a tabela de preview */
#dataPreview {
  margin-top: 20px;
  overflow-x: auto;
}

.preview-table {
  width: 100%;
  border-collapse: collapse;
}

.preview-table th, .preview-table td {
  border: 1px solid #ddd;
  padding: 8px;
  font-size: 14px;
}

.preview-table th {
  background-color: #f2f2f2;
  text-align: left;
}

#status {
  margin-top: 20px;
  font-weight: bold;
}

.success {
  color: green;
}

.error {
  color: red;
}

/* Estilos para o footer */
footer {
  background-color: #f1f1f1;
  color: #333;
  padding: 20px 0;
}

.footer-container {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  max-width: 1000px;
  margin: 0 auto;
}

.footer-section {
  flex: 1;
  margin: 10px;
  min-width: 200px;
}

.footer-section h4 {
  font-size: 16px;
  margin-bottom: 8px;
  color: #007bff; /* Cor do título */
  border-bottom: 1px solid #ddd; /* Borda mais suave */
  padding-bottom: 5px;
}

.footer-section p, .footer-section li {
  font-size: 12px;
  line-height: 1.5;
}

.footer-bottom {
  text-align: center;
  padding-top: 10px;
  font-size: 12px;
  border-top: 1px solid #ccc; /* Borda clara */
}

  </style>
</head>
<body>
  <div class="container">
    <h1>Processador de Dados de Laudos Médicos</h1>
    <h2>Gerência de Previdência - GPREV-SEDUC-AM</h2>

    <label for="fileInput">Carregar arquivo de texto</label>
    <input type="file" id="fileInput" accept=".txt" onchange="loadFile(event)">

    <textarea id="dataInput" rows="15" placeholder="Cole os dados brutos aqui ou carregue um arquivo de texto (.txt).">AMAZONAS
      GOVERNO DO ESTADO
      JUNTA MÉDICA - PERICIAL DO ESTADO
      
      servidor(a) THIAGO LUCAS DA SILVA
      CPF: 12345678901
      público, matrícula n° 111.222-3A lotado no (a): SEDUC
      unidade: GABINETE DO SECRETARIO
      ocupado do Cargo de: ANALISTA ADMINISTRATIVO
      e residente a: Rua das Acácias, N° 101
      CEP: 69043000
      Bairro: Centro
      cidade: MANAUS/AMAZONAS
      telefone: (92) 98888-0001
      de
      acordo com o atestado em anexo, vem perante essa Junta Médica Pericial do Estado requerer:
      LICENÇA MÉDICA/ESTATUTÁRIA
      Data: 30/08/2024
      LAUDO MÉDICO N°: 283890/2024
      Período: 
      Por 15 dias
      01/09/2024 à 15/09/2024
      Data do exame: 30/08/2024
      CID: Z00.0
      Licença: Acompanhamento de Saúde
      Junta Especial
      Perito: Dr. Rafael Santos
      CRMAM: 1234
      
      ---
      
      servidor(a) JULIANA MARIA FERNANDES
      CPF: 23456789012
      público, matrícula n° 222.333-4B lotado no (a): SEDUC
      unidade: ESCOLA MUNICIPAL
      ocupado do Cargo de: PROFESSOR
      e residente a: Avenida Brasil, N° 202
      CEP: 69049450
      Bairro: Nova Esperança
      cidade: MANAUS/AMAZONAS
      telefone: (92) 97777-0002
      de
      acordo com o atestado em anexo, vem perante essa Junta Médica Pericial do Estado requerer:
      LICENÇA MÉDICA/ESTATUTÁRIA
      Data: 12/09/2024
      LAUDO MÉDICO N°: 284669/2024
      Período: 
      Por 30 dias
      12/09/2024 à 12/10/2024
      Data do exame: 12/09/2024
      CID: M75.1
      Licença: Lesão por Esforço Repetitivo
      Junta Especial
      Perito: Dr. Cláudio Almeida
      CRMAM: 5678
      
      ---
      
      servidor(a) CAMILA CRISTINA ALMEIDA
      CPF: 34567890123
      público, matrícula n° 333.444-5C lotado no (a): SEDUC
      unidade: ESCOLA TÉCNICA
      ocupado do Cargo de: COORDENADOR
      e residente a: Rua dos Lírios, N° 303
      CEP: 69012345
      Bairro: Jardim Tropical
      cidade: MANAUS/AMAZONAS
      telefone: (92) 96666-0003
      de
      acordo com o atestado em anexo, vem perante essa Junta Médica Pericial do Estado requerer:
      LICENÇA MÉDICA
      Data: 01/08/2024
      LAUDO MÉDICO N°: 283891/2024
      Período: 
      Por 45 dias
      01/08/2024 à 15/09/2024
      Data do exame: 01/08/2024
      CID: F32.1
      Licença: Transtorno Depressivo
      Junta Especial
      Perito: Dr. Fernando Silva
      CRMAM: 4321
      
      ---
      
      servidor(a) VITOR HUGO REIS
      CPF: 45678901234
      público, matrícula n° 444.555-6D lotado no (a): SEDUC
      unidade: ESCOLA ESTADUAL
      ocupado do Cargo de: EDUCADOR
      e residente a: Rua da Paz, N° 404
      CEP: 69045678
      Bairro: São Jorge
      cidade: MANAUS/AMAZONAS
      telefone: (92) 95555-0004
      de
      acordo com o atestado em anexo, vem perante essa Junta Médica Pericial do Estado requerer:
      LICENÇA MÉDICA
      Data: 05/09/2024
      LAUDO MÉDICO N°: 283892/2024
      Período: 
      Por 90 dias
      05/09/2024 à 05/12/2024
      Data do exame: 05/09/2024
      CID: M54.5
      Licença: Dor Lombar
      Junta Especial
      Perito: Dr. José Almeida
      CRMAM: 9876
      
      ---
      
      servidor(a) PAULA PEREIRA DOS SANTOS
      CPF: 56789012345
      público, matrícula n° 555.666-7E lotado no (a): SEDUC
      unidade: ESCOLA DE EDUCAÇÃO INFANTIL
      ocupado do Cargo de: AUXILIAR
      e residente a: Rua das Flores, N° 505
      CEP: 69050000
      Bairro: Morada do Sol
      cidade: MANAUS/AMAZONAS
      telefone: (92) 94444-0005
      de
      acordo com o atestado em anexo, vem perante essa Junta Médica Pericial do Estado requerer:
      LICENÇA MÉDICA
      Data: 10/09/2024
      LAUDO MÉDICO N°: 283893/2024
      Período: 
      Por 60 dias
      10/09/2024 à 10/11/2024
      Data do exame: 10/09/2024
      CID: R51
      Licença: Dor de Cabeça
      Junta Especial
      Perito: Dr. Luís Silva
      CRMAM: 3456
      
      ---
      
      servidor(a) ANDRÉ CARLOS DOS REIS
      CPF: 67890123456
      público, matrícula n° 666.777-8F lotado no (a): SEDUC
      unidade: ESCOLA MUNICIPAL
      ocupado do Cargo de: SECRETÁRIO
      e residente a: Rua da Liberdade, N° 606
      CEP: 69060000
      Bairro: Parque 10
      cidade: MANAUS/AMAZONAS
      telefone: (92) 93333-0006
      de
      acordo com o atestado em anexo, vem perante essa Junta Médica Pericial do Estado requerer:
      LICENÇA MÉDICA
      Data: 15/09/2024
      LAUDO MÉDICO N°: 283894/2024
      Período: 
      Por 20 dias
      15/09/2024 à 05/10/2024
      Data do exame: 15/09/2024
      CID: H81.3
      Licença: Problemas Auditivos
      Junta Especial
      Perito: Dr. Eduardo Lima
      CRMAM: 6543
      
      ---
      
      servidor(a) GUSTAVO DOS ANJOS
      CPF: 78901234567
      público, matrícula n° 777.888-9G lotado no (a): SEDUC
      unidade: ESCOLA ESTADUAL
      ocupado do Cargo de: PROFESSOR DE MATEMÁTICA
      e residente a: Rua da Esperança, N° 707
      CEP: 69070000
      Bairro: Centro
      cidade: MANAUS/AMAZONAS
      telefone: (92) 91111-0007
      de
      acordo com o atestado em anexo, vem perante essa Junta Médica Pericial do Estado requerer:
      LICENÇA MÉDICA
      Data: 20/09/2024
      LAUDO MÉDICO N°: 283895/2024
      Período: 
      Por 30 dias
      20/09/2024 à 20/10/2024
      Data do exame: 20/09/2024
      CID: Z72.9
      Licença: Acompanhamento Psicológico
      Junta Especial
      Perito: Dr. Pedro Gomes
      CRMAM: 7654
      
      ---
      
      servidor(a) LARISSA RIBEIRO
      CPF: 89012345678
      público, matrícula n° 888.999-0H lotado no (a): SEDUC
      unidade: ESCOLA DE EDUCAÇÃO INFANTIL
      ocupado do Cargo de: AUXILIAR DE ENSINO
      e residente a: Rua das Oliveiras, N° 808
      CEP: 69080000
      Bairro: Nova Esperança
      cidade: MANAUS/AMAZONAS
      telefone: (92) 92222-0008
      de
      acordo com o atestado em anexo, vem perante essa Junta Médica Pericial do Estado requerer:
      LICENÇA MÉDICA
      Data: 25/09/2024
      LAUDO MÉDICO N°: 283896/2024
      Período: 
      Por 10 dias
      25/09/2024 à 05/10/2024
      Data do exame: 25/09/2024
      CID: R51.1
      Licença: Cefaleia
      Junta Especial
      Perito: Dr. Alan Costa
      CRMAM: 6543
      </textarea>

    <input type="text" id="outputFilename" placeholder="Nome do arquivo de saída (sem extensão)">

    <div class="button-group">
      <button onclick="processAndPreviewData()" aria-label="Processar e pré-visualizar dados">Processar e Pré-visualizar</button>
      <button onclick="exportToExcel()" aria-label="Exportar dados para Excel">Exportar para Excel</button>
      <button id="downloadErrorReport" style="display: none;" onclick="downloadErrorReport()" aria-label="Baixar relatório de dados não processados">Baixar Relatório de Erros</button>
    </div>

    <div id="dataPreview" aria-live="polite"></div>
    <div id="status" aria-live="assertive"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
  
  <script>
    function updateFilename() {
      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const year = now.getFullYear();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      
      const filename = `LAUDO_${day}.${month}.${year}_${hours}H${minutes}M`;
      document.getElementById("outputFilename").value = filename; 
    }

    let processedData = [];

    function loadFile(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      
      reader.onload = function(e) {
        document.getElementById("dataInput").value = e.target.result;
      }
      
      reader.readAsText(file);
    }

    function processAndPreviewData() {
      let rawData = document.getElementById("dataInput").value;
      let entries = rawData.split(/(?=AMAZONAS\s+GOVERNO DO ESTADO)/);
      processedData = [];

      processedData.push([
        "Nome_Servidor", "Matrícula", "Dígito", "Letra", "Lotado", "Cargo",
        "Cidade", "Telefone", "Dia_Laudo", "Mes_Laudo", "Ano_Laudo", 
        "LAUDO MÉDICO N°", "Período_Licença", "Dia_Inicio", "Mes_Inicio", 
        "Ano_Inicio", "Dia_Fim", "Mes_Fim", "Ano_Fim", "CID", 
        "Tipo_Licença", "Motivo"
      ]);

      entries.forEach(entry => {
        let row = new Array(21).fill("");

        row[0] = entry.match(/servidor\(a\)\s+(.+?)(?=\s+CPF:|\s+público,)/)?.[1]?.trim() || "";

        let matriculaMatch = entry.match(/matrícula\s*n°?\s*(\d{1,3}(?:\.\d{3})*)-(\d)([A-Za-z])?/);
        if (matriculaMatch) {
          row[1] = matriculaMatch[1].replace(/\./g, "") || "";
          row[2] = matriculaMatch[2] || "";
          row[3] = matriculaMatch[3] || "";
        }

        row[4] = entry.match(/unidade:\s+(.+?)(?=\n)/)?.[1]?.trim() || "";
        row[5] = entry.match(/Cargo de:\s+(.+?)(?=\n)/)?.[1]?.trim() || "";
        row[6] = entry.match(/cidade:\s+(.+?)(?=\/|\n)/)?.[1]?.trim() || "";
        row[7] = entry.match(/telefone:\s+(.+?)(?=\n)/)?.[1]?.trim() || "";

        let dataLaudoMatch = entry.match(/Data\s+(\d{2})\/(\d{2})\/(\d{4})/);
        if (dataLaudoMatch) {
          row[8] = dataLaudoMatch[1]; // Dia
          row[9] = dataLaudoMatch[2]; // Mês
          row[10] = dataLaudoMatch[3]; // Ano
        }

        let laudoMatch = entry.match(/LAUDO MÉDICO N°\s+(\d+)\/(\d{4})/);
        if (laudoMatch) {
          row[11] = `${laudoMatch[1]}/${laudoMatch[2]}`;
        }

        let periodoMatch = entry.match(/Por\s+(\d+)\s+dias\s+(\d{2})\/(\d{2})\/(\d{4})\s+(?:à|a)\s+(\d{2})\/(\d{2})\/(\d{4})/);
        if (periodoMatch) {
          row[12] = periodoMatch[1]; // Número de dias
          row[13] = periodoMatch[2]; // Dia_Inicio
          row[14] = periodoMatch[3]; // Mês_Inicio
          row[15] = periodoMatch[4]; // Ano_Inicio
          row[16] = periodoMatch[5]; // Dia_Fim
          row[17] = periodoMatch[6]; // Mês_Fim
          row[18] = periodoMatch[7]; // Ano_Fim
        }

        let cidMatch = entry.match(/CID\s+([\w., ]+)/);
        row[19] = cidMatch ? cidMatch[1].trim() : "";

        // Define o Tipo de Licença
        row[20] = 5; // Sempre 5

        // Adiciona a lógica para definir o motivo
        if (row[19] === "Z39.2") {
          row[21] = 4; // Motivo para Z39.2
        } else if (row[19] === "Z76.3") {
          row[21] = 24; // Motivo para Z76.3
        } else {
          row[21] = 1; // Para qualquer outro CID
        }

        processedData.push(row);
      });

      updatePreview();

      let status = document.getElementById('status');
      status.textContent = "Dados processados com sucesso! Pronto para exportar.";
      status.className = 'success';
      
      updateFilename();
    }

    function updatePreview() {
      let preview = document.getElementById('dataPreview');
      preview.innerHTML = '';
      
      let table = document.createElement('table');
      table.className = 'preview-table';
      
      let headerRow = table.insertRow();
      processedData[0].forEach(header => {
        let th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
      });
      
      for (let i = 1; i < processedData.length; i++) {
        let row = table.insertRow();
        processedData[i].forEach(cell => {
          let td = row.insertCell();
          td.textContent = cell; // Preencher normalmente sem valores fixos
        });
      }
      
      preview.appendChild(table);
    }

    function exportToExcel() {
      if (processedData.length === 0) {
        alert("Nenhum dado processado. Por favor, processe os dados antes de exportar.");
        return;
      }

      let ws = XLSX.utils.aoa_to_sheet(processedData);
      let wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Laudos Médicos");

      const filename = document.getElementById("outputFilename").value || "Laudos_Medicos";
      XLSX.writeFile(wb, `${filename}.xlsx`);

      let status = document.getElementById('status');
      status.textContent = "Arquivo Excel exportado com sucesso!";
      status.className = 'success';
    }

    window.onload = updateFilename;
  </script>

  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h4>Sobre a Empresa</h4>
        <p>EDU TECH INOVA LTDA (CNPJ: 49.977.892/0001-74)</p>
        <p>Soluções educacionais e desenvolvimento de software sob encomenda.</p>
        <p class="address">R. Delmiro Leão, 78 - Manaus, AM</p>
      </div>

      <div class="footer-section">
        <h4>Nossa Equipe</h4>
        <ul>
          <li><strong>Mauro Frank Lima</strong> - Desenvolvedor</li>
          <li><strong>Marcus André Lima</strong> - Analista de Sistemas</li>
          <li><strong>Roberto Araújo da Silva</strong> - Relações Públicas</li>
          <li><strong>Fábio Leda Cunha</strong> - Vendas</li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>© 2024 EDU TECH INOVA LTDA. Todos os direitos reservados.</p>
    </div>
  </footer>
</body>
</html>
